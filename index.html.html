<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ARC Simple Swap</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #111; color: #fff; }
    input, select, button { padding: 10px; margin: 5px 0; width: 100%; border-radius: 6px; }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    .box { background: #222; padding: 20px; border-radius: 10px; }
  </style>
</head>
<body>
<h2>ARC Simple Swap</h2>
<p>Swap tokens usando sua carteira na ARC Testnet</p>

<div class="box">
  <button onclick="connectWallet()">Conectar Carteira</button>
  <br /><br />

  <label>Token que deseja trocar:</label>
  <select id="tokenFrom">
    <option value="0x3600000000000000000000000000000000000000">USDC</option>
    <option value="0x49cd69442dB073E7b94B0124e316AB7C68b95988">SRAC</option>
    <option value="0x6E63e2cABECCe5c3A1c37b79A958a9542076A1e3">RACS</option>
    <option value="0x63F856fBAB3535174bFaFD6EFd720C634d6FD458">SACS</option>
    <option value="0xe470A3Fb08345FD4a84c1b56Bd35bA7Be6297C3d">KITTY</option>
    <option value="0x832Fa4331050045F911bD6d59EAD144A04B965cB">DOGG</option>
  </select>

  <label>Token que deseja receber:</label>
  <select id="tokenTo">
    <option value="0x3600000000000000000000000000000000000000">USDC</option>
    <option value="0x49cd69442dB073E7b94B0124e316AB7C68b95988">SRAC</option>
    <option value="0x6E63e2cABECCe5c3A1c37b79A958a9542076A1e3">RACS</option>
    <option value="0x63F856fBAB3535174bFaFD6EFd720C634d6FD458">SACS</option>
    <option value="0xe470A3Fb08345FD4a84c1b56Bd35bA7Be6297C3d">KITTY</option>
    <option value="0x832Fa4331050045F911bD6d59EAD144A04B965cB">DOGG</option>
  </select>

  <label>Quantidade para trocar:</label>
  <input id="amount" type="number" placeholder="Ex: 10" />

  <button onclick="swapTokens()">Swap</button>

  <p id="status"></p>
</div>

<script>
let provider;
let signer;

async function connectWallet() {
  if (!window.ethereum) return alert("MetaMask não encontrada");
  await ethereum.request({ method: "eth_requestAccounts" });
  provider = new ethers.providers.Web3Provider(window.ethereum);
  signer = provider.getSigner();
  document.getElementById("status").innerText = "Carteira conectada";
}

// ABI mínima para ERC20
const abi = ["function transfer(address to, uint amount) public returns (bool)",
              "function transferFrom(address from, address to, uint amount) public returns (bool)",
              "function approve(address spender, uint amount) public returns (bool)"];

// Endereço do "cofre" que recebe taxa e faz swap simples
const VAULT = "0x000000000000000000000000000000000000dEaD";
const FEE = ethers.utils.parseUnits("1", 6); // taxa fixa 1 USDC

async function swapTokens() {
  const fromToken = document.getElementById("tokenFrom").value;
  const toToken = document.getElementById("tokenTo").value;
  const amount = document.getElementById("amount").value;

  if (fromToken === toToken) return alert("Escolha tokens diferentes");

  const contract = new ethers.Contract(fromToken, abi, signer);

  const parsedAmount = ethers.utils.parseUnits(amount, 18);

  try {
    document.getElementById("status").innerText = "Processando…";

    // 1. Pagar taxa em USDC
    const usdc = new ethers.Contract("0x3600000000000000000000000000000000000000", abi, signer);
    await usdc.transfer(VAULT, FEE);

    // 2. Fazer transferência do token escolhido para o vault
    await contract.transfer(VAULT, parsedAmount);

    document.getElementById("status").innerText = "Swap concluído (simples)!";
  } catch (err) {
    console.error(err);
    document.getElementById("status").innerText = "Erro: " + err.message;
  }
}
</script>
</body>
</html>
